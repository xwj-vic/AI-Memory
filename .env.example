# ==============================================================================
# AI-Memory 环境变量配置模板
# ==============================================================================
# 使用方法：
# 1. 本地开发：将此文件复制为 .env 并填写配置。
# 2. Docker 部署：docker-compose 会自动读取根目录下的 .env 文件。
#    注：Docker 环境下，基础设施地址（REDIS_ADDR, DB_HOST, QDRANT_ADDR）
#    会在 docker-compose.yml 中被强制覆盖为容器名，其余配置均透传自 .env。
# ==============================================================================

# ---------- 基础基础设施 (Infrastructure) ----------
# Redis 地址（用于 STM 和 Staging 存储）
REDIS_ADDR=localhost:6379
REDIS_PASSWORD=
REDIS_DB=0

# MySQL 地址（用于用户鉴权、Admin 管理及告警指标持久化）
DB_HOST=localhost:3306
DB_USER=root
DB_PASS=
DB_NAME=ai_memory

# Qdrant 地址（用于 LTM 向量存储）
QDRANT_ADDR=localhost:6334
QDRANT_COLLECTION=ai_memory


# ---------- LLM & Embedding 配置 ----------
# LLM 提供商 (目前仅支持 openai)
LLM_PROVIDER=openai

# OpenAI / 兼容接口配置
OPENAI_API_KEY=sk-your-key-here
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini
OPENAI_EMBEDDING_MODEL=text-embedding-ada-002


# ---------- 记忆引擎核心逻辑 (Memory Funnel Core) ----------

# STM (短期记忆)
# STM_CONTEXT_WINDOW: 召回时的上下文消息数量
STM_CONTEXT_WINDOW=10
# MAX_RECENT_MEMORIES: 召回任务的总记忆数量上限
MAX_RECENT_MEMORIES=100

STM_WINDOW_SIZE=100              # STM 滑动窗口大小（条数）
STM_MAX_RETENTION_DAYS=7         # STM 数据最长保留天数
STM_EXPIRATION_DAYS=7            # STM 自动清理天数（0 表示不过期）
STM_BATCH_JUDGE_SIZE=10          # 批量判定时的最大消息数

# STM -> Staging 判定触发阈值
STM_JUDGE_MIN_MESSAGES=5         # 触发判定的最小未判定消息数
STM_JUDGE_MAX_WAIT_MINUTES=60    # 第一条未判定消息的最大等待时间（分钟）

# Staging (暂存区/记忆候选)
STAGING_MIN_OCCURRENCES=2        # 被视为记忆候选的最小出现次数
STAGING_MIN_WAIT_HOURS=48        # 晋升为 LTM 前的最小观察时长（小时）
STAGING_VALUE_THRESHOLD=0.6      # LLM 价值评分阈值 (0.0-1.0)
STAGING_CONFIDENCE_HIGH=0.8      # 高置信度阈值（达到此值自动晋升 LTM）
STAGING_CONFIDENCE_LOW=0.5       # 低置信度阈值（低于此值直接丢弃）

# LTM (长期记忆)
LTM_DECAY_HALF_LIFE_DAYS=90      # 艾宾浩斯遗忘曲线半衰期（天）
LTM_DECAY_MIN_SCORE=0.3          # 记忆删除阈值（分数低于此值则“遗忘”）

# 模型细分
JUDGE_MODEL=gpt-4o-mini          # 用于 STM 判定和重构的模型（建议用高效模型）
EXTRACT_TAGS_MODEL=gpt-4o        # 用于 LTM 标签提取和关联的模型（建议用强大模型）


# ---------- 监控与性能 (Monitoring) ----------
METRICS_PERSIST_INTERVAL_MINUTES=1    # 运行指标写入数据库的频率（分钟）
METRICS_HISTORY_LOAD_HOURS=24         # 启动时预加载的历史数据范围（小时）
METRICS_MEMORY_RETENTION_HOURS=1      # 内存中保留的实时指标时长（小时）
METRICS_RETENTION_DAYS=30             # 数据库中历史指标保留天数


# ---------- 告警系统 (Alert System) ----------
ALERT_CHECK_INTERVAL_MINUTES=1        # 异常检测运行频率（分钟）
ALERT_HISTORY_MAX_SIZE=100            # 系统保留的告警消息历史上限

# Webhook 告警通知
ALERT_WEBHOOK_ENABLED=false
ALERT_WEBHOOK_URL=
ALERT_WEBHOOK_TIMEOUT_SECONDS=5

# 邮件告警通知
ALERT_EMAIL_ENABLED=false
ALERT_EMAIL_SMTP_HOST=smtp.example.com
ALERT_EMAIL_SMTP_PORT=587
ALERT_EMAIL_USERNAME=
ALERT_EMAIL_PASSWORD=
ALERT_EMAIL_FROM=AI-Memory Alert <alert@example.com>
ALERT_EMAIL_TO=
ALERT_EMAIL_USE_TLS=true

# 告警级别过滤 (ERROR, WARNING, INFO)
ALERT_NOTIFY_LEVELS=ERROR,WARNING

# 智能缓存检测配置 (Alert Cache Detection)
ALERT_CACHE_WINDOW_MINUTES=5          # 统计窗口 (分钟)
ALERT_CACHE_MIN_SAMPLES=500           # 最小样本数
ALERT_CACHE_WARN_THRESHOLD=30         # 警告阈值 (百分比)
ALERT_CACHE_ERROR_THRESHOLD=15        # 错误阈值 (百分比)
ALERT_CACHE_TREND_PERIODS=3           # 趋势检测周期数


# ---------- 日志与系统 (Logs) ----------
LOG_DIR=log                           # 日志存储目录
